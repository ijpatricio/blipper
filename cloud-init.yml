#cloud-config

users:
  - name: revico
    groups: sudo, docker
    shell: /bin/bash
    sudo: [ 'ALL=(ALL) NOPASSWD:ALL' ]
    lock_passwd: true
    ssh_authorized_keys:
      - "{{SSH_PUBLIC_KEY}}"

groups:
  - docker

# Set timezone
timezone: Europe/London

runcmd:
  - |
    echo "BASIC_AUTH_USER={{BASIC_AUTH_USER}}" > /home/revico/.initial-env
    echo "BASIC_AUTH_PASSWORD={{BASIC_AUTH_PASSWORD}}" >> /home/revico/.initial-env
    su - revico -c "curl -sSL https://raw.githubusercontent.com/ijpatricio/remote-vibe-coder/main/install/download.sh | bash"
    su - revico -c "cd /home/revico/revico && ./install/install.sh"
